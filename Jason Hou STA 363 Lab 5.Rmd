---
title: "STA 363 Lab 4"
author: "Jason Hou"
date: '2022-09-29'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source("http://www.openintro.org/stat/data/cdc.R")
```



```{r load packages}
#Load all required packages
library(ggplot2)
library(broom)
library(gridExtra)
library(dplyr)
library(class)
library(tidyverse)
library(gridExtra)
library(leaps)
```

```{r}
glimpse(cdc)
```


## Question 1 
*Is this a regression or classification task?*

This is a regression task since the response variable is numeric

## Question 2 
*Create a box plot of the response variable. Does it seem like anything is unusual? If so, explain what and how you will choose to handle it before analysis.*

```{r }
cdc$wtchange<- cdc$weight -cdc$wtdesire

```

```{r boxplot}
LossGainBox<-ggplot(data=cdc,aes(x=wtchange))+
  geom_boxplot()
LossGainBox
```

The boxplot indicates unusually high and low extreme values in the data set. I would try to remove the extreme and unreasonable values before the analysis in order to handle this issue.

```{r remove extreme values}
cdcSelected<-cdc
#cdcSelected$wtchange=cdcSelected$wtchange[cdcSelected$wtchange > upper_bound]
#upper_bound <- 21+1.5*sd(cdcSelected$wtchange)

cdcSelected<-cdcSelected%>%
  filter(wtchange<200)


```


## Question 3
*Create an appropriate plot to visualize the relationship between weight and desired weight change. Label your plot Figure 2. Based on shape alone, does LSLR seem like a reasonable choice?*

```{r LSLR check graph}
weight_desiredWt<-ggplot(data=cdcSelected,aes(x=weight,y=wtchange))+
  geom_point()
weight_desiredWt

```

Based on the shape of the scatter plot alone, LSLR seem like a reasonable choice.

## Question 4
*Write down the population form of the LSLR regression model (so include the error term, no hats) in matrix form in the white space in your Markdown file. This is to help you practice writing matrix notation. Remember that to start an equation you use $ in the white space, and that the R Code help site for our course has examples. Example: $Y = \beta_0 + \beta_1 X + \epsilon$. Hint: To make a symbol bold, you use \boldsymbol{}. To make text bold, you use \mathbf{}.*

$$\widehat{Y} = \matrix{\boldsymbol{1}&\boldsymbol{X}}\cdot\boldsymbol{\beta} $$

$$\widehat{Y}=\boldsymbol{X_D}\boldsymbol{\beta}+\epsilon$$

## Question 5

*Create the needed design matrix for an LSLR model for Y= desired weight change and X = weight and store the result as XD. Show the first few rows of your matrix (head(XD)).*

$$\widehat{Y} = \matrix{\boldsymbol{1}&\boldsymbol{X}}$$

```{r XD}
X<-cdcSelected[,c("weight")]
XD<-cbind(1,X)
Y<-cdcSelected$wtchange
knitr::kable(head(XD),caption = "First Few Rows of Matrix XD")
```

## Question 6
*State the dimensions of Y and the dimensions of XD.*

The dimension of Y is 19988\*1(19988 rows and 1 column). The dimension of XD is 19988\*2(19988 rows and 2 columns).


## Question 7 

$$\boldsymbol{\widehat{\beta}} = (\boldsymbol{X^\mathbf{T}_\mathbf{D}X_\mathbf{D}})^{-1}\boldsymbol{X^\mathbf{T}_\mathbf{D}Y}$$

## Question 8

```{r}
result<-solve(t(XD)%*%XD)%*%t(XD)%*%Y
knitr::kable(result)
```

$$\boldsymbol{\widehat{\beta}}=\matrix{-44.81983445\\0.3496484}$$

## Question 9

*Based on your LSLR line, find the estimated desired weight change for the 5th individual in the data.*

```{r}
cdcSelected[5,6]
```


$$Estimated\ Desire\ Weight\ Change = -44.820 + 0.350* 150=7.68$$

The estimated desired weight change for the 5th individual of the data is 7.68 lbs.


## Question 10
*Why do we need to remove wtdesire from the data before running BSS? Make sure you remove that column from the data before proceeding.*

```{r}
cdcSelected<-cdcSelected%>%
  select(-c("wtdesire"))
```

We need to remove the wtdesire from the data before running BSS because our response variable is derived from wtdesire.

## Question 11
*Based on this, how many models do you think we fit in Stage 1 (Step 1) of BSS? Hint: Think carefully here. Some of the variables are categorical with more than two levels.*

```{r}
features<-cdcSelected[,c(1,2,3,4,5,6,7,8)]
results<-data.frame("Intercept"=rep(NA,12),slope=rep(NA,12))
for(i in 1:8){
  X2<-features[,i]
  X2D<-cbind(1,X2)
  Y<-cdcSelected$wtchange
  intercept<-
  results$Intercept=
  

}
```


We would have 12 models, since some of the categorical variables are having more than 2 levels, and the models will be fitted for all the levels beside the base level. 




## Question 12

*Once we have fit all the models in with two features, how do you think we choose one? Hint: Same as Stage 1 (Step 1).*

```{r}

```


## Question 13

*How many Î² terms are in this full model? In other words, we end with Stage 1 ( Step what) ? Hint: If you are stuck, just fit the model in R and look. You can do this by putting in all the features manually, or using ModelFull <- lm( wtchange ~ . , data = cdc).*

```{r}

```

## Question


