---
title: "STA 363 Lab 4"
author: "Jason Hou"
date: '2022-09-15'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages}
library(tidyverse)
library(broom)
library(dplyr)
library(knitr)
library(class)
```


```{r load data and cleaning}
library(palmerpenguins)
data("penguins")

penguins <- na.omit(penguins)
```


## Question 1
*How many rows should be in each fold for our penguins data? Will all the folds have exactly the same number of rows? Explain your reasoning.*

```{r}
knitr::kable(nrow(penguins),col.names = "Number of Rows in Penguin Data")
```

We should have 33 rows in fold of the penguins data. Some folds will not have exactly the same number of rows since 333 is not fully divisible by 10.

## Question 2
*Create a data set called penguinsSmall that contains the first 20 rows in the penguin data set. If we use 5-fold CV with this smaller data set, how many rows belong in each fold?*

```{r small set}
penguinsSmall<-penguins[1:20,]
```

If we use 5-fold CV with this small data set, there will be 4 rows belong in each fold.

## Question 3

*For our 5-fold CV with penguinsSmall, how many slips of paper in this box need to contain the number 4?*

For the 5-fold CV with penguinSmall, there are 4 slips of paper in this box contain the number 4.

```{r paper}
papers <- rep(1:5, 4)
```

## Question 4

*Suppose we have a data set with 500 rows, and we want to use 5-fold CV. What code would need to create the equivalent of the papers vector for this new data set?*

```{r 500 rows, message=FALSE}
Row500<-rep(1:100,5)
```

The code Row500<-rep(1:100,5) could create the equivalent of papers vector for this new data set.

```{r fold sampling }
set.seed(363663)
foldsSmall <- sample(papers, 20, replace = FALSE)
```

## Question 5
*Which fold is the 5th row in the data set assigned to? What about the 20th row?*
```{r view fold}
Result20Row<-data.frame(foldsSmall)

RowInfo<-data.frame("RowNumber" = rep(NA,2),"Fold_went_to"=rep(NA,2))
RowInfo$RowNumber[1]<-"5"
RowInfo$RowNumber[2]<-"20"
RowInfo$Fold_went_to[1]<-Result20Row[5,]
RowInfo$Fold_went_to[2]<-Result20Row[20,]
knitr::kable(RowInfo)
```

The 5th row in the data set was assigned to fold 3.The 20th rows of the data is was assigned to fold 3.


## Question 6
*Use R to assign the 333 rows to 10 folds. Use the same seed as we did in the previous section (363663). Which fold is the 1st row in the penguins data set assigned to? What about the second row? Hint: Make sure you change the names of papers and foldSmall so you donâ€™t replace these vectors with new ones. We will need the ones from the previous example in the next section!*


```{r sampling from 333 data}
set.seed(363663)
boxes<-rep(1:10,34)
foldPenguin<-sample(boxes,333,replace = FALSE)
view(foldPenguin)

```

The 1st row in the penguins data set was assigned to fold 2. The 2nd row in the penguins data set was assigned to fold 4.

## Question 7
*Which rows in the penguinsSmall data set are in fold 1?*

```{r rows assigned to fold 1 (penguinSmall Set)}
knitr::kable(which(foldsSmall == 1),col.names = "Rows Assigned to Fold 1 in penguinSmall")
```

## Question 8
*Which rows in the penguinsSmall data set are in fold 2?*

```{r rows assigned to fold 2 (penguinSmall Set)}
which(foldsSmall == 2)
```

Rows 2, 13, 15 and 19 in penguinSmall data set are assigned to fold 2. 

```{r creating data set, include=FALSE}
fold1 <- penguinsSmall[which(foldsSmall==1), ]
fold1
```


## Question 9
*Create fold 2 (meaning show the fold 2 data set) for penguinsSmall. Check to make sure the row numbers match what you have in Question 8!*

```{r fold 2 data set}
fold2<-penguinsSmall[(which(foldsSmall == 2)),]
fold2
```

## Question 10
*Create fold 10 (meaning show the fold 10 data set) for penguins.*

```{r fold 10, include=FALSE}
fold10<-penguins[which(foldPenguin == 10),]
fold10
```

## Question 11
*What are the dimensions of storageSmall? (This means how many rows and how many columns).*

```{r dimensions of storageSmall}
storageSmall <- data.frame("YHat" = rep(NA,20))
view(storageSmall)
```

The dimension of storageSmall is 20*1(20 rows and 1 column).

## Question 12
*Code and run Step 1 - 4 above. Recall that our goal for today is to predict Y = the sex of the penguin based on the flipper length and bill length of that penguin. Print out the storageSmall vector when you have completed the steps. Which rows are currently filled in? Does it make sense that these rows are filled in? Explain.NOTE: When you store the predicted penguin sex, use as.character(Kpreds). Why? Because this time our response variable is recorded as words rather than numbers*

```{r fold 1}
f<-1
newTrainF1<-penguinsSmall[-which(foldsSmall == f),]
newTestF1<-penguinsSmall[which(foldsSmall == f),]

K_predsFold1<-knn(newTrainF1[,c(3,5)],newTestF1[,c(3,5)],cl = newTrainF1$sex,k=5)

storageSmall$YHat[f]<-as.character(K_predsFold1)
print(storageSmall)
```

The first row is filled in. It is filled in because the number that f equals to(which is 1) is used to indicate the row that the result of prediction(k_preds) goes to when assigning predicted values to the storageSmall data set.

## Question 13

*Repeat this process but now move on to fold 2. Print out the storageSmall vector when you have completed the steps. Which rows are currently filled in? Does it make sense that these rows are filled in? Explain.*

```{r fold 2 prediction}
g<-2
newTrainF2<-penguinsSmall[-which(foldsSmall == f),]
newTestF2<-penguinsSmall[which(foldsSmall == f),]

K_predsFold2<-knn(newTrainF2[,c(3,5)],newTestF2[,c(3,5)],cl = newTrainF2$sex,k=5)

storageSmall$YHat[g]<-as.character(K_predsFold2)
```

Now, row 2 was filled. It is filled in because g's value(which is 2) is used to indicate the row that the result of prediction(k_preds) goes to when assigning predicted values to the storageSmall data set.


## Question 14
*Create a for loop to run 5-fold CV on the small data set. Print out the storageSmall vector when you have completed the loop.*

```{r loop, echo=FALSE}
i<-1
for(i in 1:5){
  infold<-which(foldsSmall == i)
  newTrain_5F<-penguinsSmall[-infold,]
  newTest_5F<-penguinsSmall[infold,]
  
  K_preds_5Fold<-knn(newTrain_5F[,c(3,5)],newTest_5F[,c(3,5)],cl = newTrain_5F$sex,k=5)
  
  storageSmall$YHat[infold]<-as.character(K_preds_5Fold)
}

knitr::kable(print(storageSmall))

```

## Question 15
*Create a for loop to run 10-fold CV on the penguins data set. Create a confusion matrix when you finish the loop.*

```{r}
storagePenguin<-data.frame("Yhat"=rep(NA,333))
```


```{r 333 10 folds}
for(p in 1:10){
  infoldFull_set<-which(foldPenguin == p)
  penguinTrain<-penguins[-infoldFull_set,]
  penguinTest<-penguins[infoldFull_set,]
  
  K_preds_penguin<-knn(penguinTrain[,c(3,5)],penguinTest[,c(3,5)],cl = penguinTrain$sex,k=5)
  
  storagePenguin$Yhat[infoldFull_set]<-as.character(K_preds_penguin)
}
knitr::kable(print(storagePenguin$Yhat))
```


## Question 16
*What is the geometric mean of sensitivity (Y = 1 = male) and specificity (Y = 0 = female) for 10-fold CV with 5 nearest neighbors? Show your work.*
